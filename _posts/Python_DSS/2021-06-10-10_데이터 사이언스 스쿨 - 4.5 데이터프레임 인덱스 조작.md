---
title: "[Python] 데이터 사이언스 스쿨 - 4.5 데이터프레임 인덱스 조작"
excerpt: "4.5 데이터프레임 인덱스 조작"
categories: 
  - dss
tags: 
    - Python
    - dss
# toc: TRUE
# toc_sticky: TRUE
use_math: TRUE
---

[데이터 사이언스 스쿨](https://datascienceschool.net/intro.html) 자료를 토대로 공부한 내용입니다.

실습과정에서 필요에 따라 내용의 누락 및 추가, 수정사항이 있습니다.

---


# 4.5 데이터프레임 인덱스 조작

## 데이터프레임 인덱스 설정 및 제거


```python
import numpy as np
import pandas as pd
```


```python
# 데이터 프레임 생성
np.random.seed(0)
df1 = pd.DataFrame(np.vstack([list('ABCDE'),
                              np.round(np.random.rand(3, 5), 2)]).T,
                   columns=["C1", "C2", "C3", "C4"])
df1
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>C1</th>
      <th>C2</th>
      <th>C3</th>
      <th>C4</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>A</td>
      <td>0.55</td>
      <td>0.65</td>
      <td>0.79</td>
    </tr>
    <tr>
      <th>1</th>
      <td>B</td>
      <td>0.72</td>
      <td>0.44</td>
      <td>0.53</td>
    </tr>
    <tr>
      <th>2</th>
      <td>C</td>
      <td>0.6</td>
      <td>0.89</td>
      <td>0.57</td>
    </tr>
    <tr>
      <th>3</th>
      <td>D</td>
      <td>0.54</td>
      <td>0.96</td>
      <td>0.93</td>
    </tr>
    <tr>
      <th>4</th>
      <td>E</td>
      <td>0.42</td>
      <td>0.38</td>
      <td>0.07</td>
    </tr>
  </tbody>
</table>
</div>




```python
# set_index: 기존 열을 인덱스로 사용
df2 = df1.set_index("C1")
df2
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>C2</th>
      <th>C3</th>
      <th>C4</th>
    </tr>
    <tr>
      <th>C1</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>A</th>
      <td>0.55</td>
      <td>0.65</td>
      <td>0.79</td>
    </tr>
    <tr>
      <th>B</th>
      <td>0.72</td>
      <td>0.44</td>
      <td>0.53</td>
    </tr>
    <tr>
      <th>C</th>
      <td>0.6</td>
      <td>0.89</td>
      <td>0.57</td>
    </tr>
    <tr>
      <th>D</th>
      <td>0.54</td>
      <td>0.96</td>
      <td>0.93</td>
    </tr>
    <tr>
      <th>E</th>
      <td>0.42</td>
      <td>0.38</td>
      <td>0.07</td>
    </tr>
  </tbody>
</table>
</div>



- `set_index()`를 이용하면 기존의 열을 행 인덱스로 사용 가능하다.


```python
# 새로 인덱스 지정시 기존 인덱스는 사라짐
df2.set_index("C2")
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>C3</th>
      <th>C4</th>
    </tr>
    <tr>
      <th>C2</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0.55</th>
      <td>0.65</td>
      <td>0.79</td>
    </tr>
    <tr>
      <th>0.72</th>
      <td>0.44</td>
      <td>0.53</td>
    </tr>
    <tr>
      <th>0.6</th>
      <td>0.89</td>
      <td>0.57</td>
    </tr>
    <tr>
      <th>0.54</th>
      <td>0.96</td>
      <td>0.93</td>
    </tr>
    <tr>
      <th>0.42</th>
      <td>0.38</td>
      <td>0.07</td>
    </tr>
  </tbody>
</table>
</div>



- `set_index()`로 인덱스를 지정하면 기존 인덱스는 사라진다.


```python
# reset_index: 인덱스를 보통의 자료열로 복구 - 인덱스는 정수 인덱스로 바뀜
df2.reset_index()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>C1</th>
      <th>C2</th>
      <th>C3</th>
      <th>C4</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>A</td>
      <td>0.55</td>
      <td>0.65</td>
      <td>0.79</td>
    </tr>
    <tr>
      <th>1</th>
      <td>B</td>
      <td>0.72</td>
      <td>0.44</td>
      <td>0.53</td>
    </tr>
    <tr>
      <th>2</th>
      <td>C</td>
      <td>0.6</td>
      <td>0.89</td>
      <td>0.57</td>
    </tr>
    <tr>
      <th>3</th>
      <td>D</td>
      <td>0.54</td>
      <td>0.96</td>
      <td>0.93</td>
    </tr>
    <tr>
      <th>4</th>
      <td>E</td>
      <td>0.42</td>
      <td>0.38</td>
      <td>0.07</td>
    </tr>
  </tbody>
</table>
</div>



- `reset_index()`를 사용하면 인덱스를 열로 사용한다.


```python
# drop 옵션을 주면 자료가 복구되지 않고 버려짐
df2.reset_index(drop=True)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>C2</th>
      <th>C3</th>
      <th>C4</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.55</td>
      <td>0.65</td>
      <td>0.79</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.72</td>
      <td>0.44</td>
      <td>0.53</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.6</td>
      <td>0.89</td>
      <td>0.57</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.54</td>
      <td>0.96</td>
      <td>0.93</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.42</td>
      <td>0.38</td>
      <td>0.07</td>
    </tr>
  </tbody>
</table>
</div>



- drop 옵션을 True로 설정하면 인덱스를 열로 사용하지 않고 제거한다.

## 연습 문제 4.5.1

5명의 학생의 국어, 영어, 수학 점수를 나타내는 데이터프레임을 다음과 같이 만든다.

1. 학생 이름을 나타내는 열을 포함시키지 않고 데이터프레임 `df_score1` 을 생성한 후, `df_score1.index` 속성에 학생 이름을 나타내는 열을 지정하여 인덱스를 지정한다. `reset_index` 명령으로 이 인덱스 열을 명령으로 일반 데이터열로 바꾸여 데이터프레임 `df_score2`을 만든다.


2. 학생 이름을 나타내는 열이 일반 데이터 열을 포함하는 데이터프레임 `df_score2`에 `set_index` 명령을 적용하여 다시 학생 이름을 나타내는 열을 인덱스로 변경한다.


```python
# 데이터 프레임 생성
np.random.seed(93)
df_score1 = pd.DataFrame(
    np.random.randint(0,101, size=(5,3)),
    columns = ["국어", "수학", "영어"]
)
df_score1
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>국어</th>
      <th>수학</th>
      <th>영어</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>37</td>
      <td>91</td>
      <td>4</td>
    </tr>
    <tr>
      <th>1</th>
      <td>24</td>
      <td>79</td>
      <td>97</td>
    </tr>
    <tr>
      <th>2</th>
      <td>85</td>
      <td>48</td>
      <td>77</td>
    </tr>
    <tr>
      <th>3</th>
      <td>52</td>
      <td>52</td>
      <td>51</td>
    </tr>
    <tr>
      <th>4</th>
      <td>21</td>
      <td>49</td>
      <td>74</td>
    </tr>
  </tbody>
</table>
</div>




```python
# 인덱스 지정하기
df_score1.index = ["학생1", "학생2", "학생3", "학생4", "학생5"]
df_score1.index.name = "학생"
df_score1
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>국어</th>
      <th>수학</th>
      <th>영어</th>
    </tr>
    <tr>
      <th>학생</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>학생1</th>
      <td>37</td>
      <td>91</td>
      <td>4</td>
    </tr>
    <tr>
      <th>학생2</th>
      <td>24</td>
      <td>79</td>
      <td>97</td>
    </tr>
    <tr>
      <th>학생3</th>
      <td>85</td>
      <td>48</td>
      <td>77</td>
    </tr>
    <tr>
      <th>학생4</th>
      <td>52</td>
      <td>52</td>
      <td>51</td>
    </tr>
    <tr>
      <th>학생5</th>
      <td>21</td>
      <td>49</td>
      <td>74</td>
    </tr>
  </tbody>
</table>
</div>




```python
# 1. reset_index
df_score2 = df_score1.reset_index()
df_score2
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>학생</th>
      <th>국어</th>
      <th>수학</th>
      <th>영어</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>학생1</td>
      <td>37</td>
      <td>91</td>
      <td>4</td>
    </tr>
    <tr>
      <th>1</th>
      <td>학생2</td>
      <td>24</td>
      <td>79</td>
      <td>97</td>
    </tr>
    <tr>
      <th>2</th>
      <td>학생3</td>
      <td>85</td>
      <td>48</td>
      <td>77</td>
    </tr>
    <tr>
      <th>3</th>
      <td>학생4</td>
      <td>52</td>
      <td>52</td>
      <td>51</td>
    </tr>
    <tr>
      <th>4</th>
      <td>학생5</td>
      <td>21</td>
      <td>49</td>
      <td>74</td>
    </tr>
  </tbody>
</table>
</div>




```python
# 2. set_index
df_score2.set_index("학생")
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>국어</th>
      <th>수학</th>
      <th>영어</th>
    </tr>
    <tr>
      <th>학생</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>학생1</th>
      <td>37</td>
      <td>91</td>
      <td>4</td>
    </tr>
    <tr>
      <th>학생2</th>
      <td>24</td>
      <td>79</td>
      <td>97</td>
    </tr>
    <tr>
      <th>학생3</th>
      <td>85</td>
      <td>48</td>
      <td>77</td>
    </tr>
    <tr>
      <th>학생4</th>
      <td>52</td>
      <td>52</td>
      <td>51</td>
    </tr>
    <tr>
      <th>학생5</th>
      <td>21</td>
      <td>49</td>
      <td>74</td>
    </tr>
  </tbody>
</table>
</div>



## 다중 인덱스


```python
# 다중 열 인덱스
np.random.seed(0)
df3 = pd.DataFrame(np.round(np.random.randn(5, 4), 2),
                   columns=[["A", "A", "B", "B"],
                            ["C1", "C2", "C1", "C2"]])
df3
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="2" halign="left">A</th>
      <th colspan="2" halign="left">B</th>
    </tr>
    <tr>
      <th></th>
      <th>C1</th>
      <th>C2</th>
      <th>C1</th>
      <th>C2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.76</td>
      <td>0.40</td>
      <td>0.98</td>
      <td>2.24</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.87</td>
      <td>-0.98</td>
      <td>0.95</td>
      <td>-0.15</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-0.10</td>
      <td>0.41</td>
      <td>0.14</td>
      <td>1.45</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.76</td>
      <td>0.12</td>
      <td>0.44</td>
      <td>0.33</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.49</td>
      <td>-0.21</td>
      <td>0.31</td>
      <td>-0.85</td>
    </tr>
  </tbody>
</table>
</div>



- 데이터 프레임을 생성할 때 위 예시와 같이 다중 열 인덱스를 생성 가능하다.


- columns 옵션에 상위 인덱스부터 순서대로 작성한다.


```python
# 열 인덱스 이름 지정
df3.columns.names = ["Cidx1", "Cidx2"]
df3
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th>Cidx1</th>
      <th colspan="2" halign="left">A</th>
      <th colspan="2" halign="left">B</th>
    </tr>
    <tr>
      <th>Cidx2</th>
      <th>C1</th>
      <th>C2</th>
      <th>C1</th>
      <th>C2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.76</td>
      <td>0.40</td>
      <td>0.98</td>
      <td>2.24</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.87</td>
      <td>-0.98</td>
      <td>0.95</td>
      <td>-0.15</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-0.10</td>
      <td>0.41</td>
      <td>0.14</td>
      <td>1.45</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.76</td>
      <td>0.12</td>
      <td>0.44</td>
      <td>0.33</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.49</td>
      <td>-0.21</td>
      <td>0.31</td>
      <td>-0.85</td>
    </tr>
  </tbody>
</table>
</div>



- 다중 열 인덱스도 인덱스의 이름을 각각 지정 가능하다.


- 마찬가지로 상위 인덱스 이름부터 순서대로 작성한다.


```python
# 다중 행/열 인덱스
np.random.seed(0)
df4 = pd.DataFrame(np.round(np.random.randn(6, 4), 2),
                   columns=[["A", "A", "B", "B"],
                            ["C", "D", "C", "D"]],
                   index=[["M", "M", "M", "F", "F", "F"],
                          ["id_" + str(i + 1) for i in range(3)] * 2])
df4.columns.names = ["Cidx1", "Cidx2"]
df4.index.names = ["Ridx1", "Ridx2"]
df4
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th>Cidx1</th>
      <th colspan="2" halign="left">A</th>
      <th colspan="2" halign="left">B</th>
    </tr>
    <tr>
      <th></th>
      <th>Cidx2</th>
      <th>C</th>
      <th>D</th>
      <th>C</th>
      <th>D</th>
    </tr>
    <tr>
      <th>Ridx1</th>
      <th>Ridx2</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="3" valign="top">M</th>
      <th>id_1</th>
      <td>1.76</td>
      <td>0.40</td>
      <td>0.98</td>
      <td>2.24</td>
    </tr>
    <tr>
      <th>id_2</th>
      <td>1.87</td>
      <td>-0.98</td>
      <td>0.95</td>
      <td>-0.15</td>
    </tr>
    <tr>
      <th>id_3</th>
      <td>-0.10</td>
      <td>0.41</td>
      <td>0.14</td>
      <td>1.45</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">F</th>
      <th>id_1</th>
      <td>0.76</td>
      <td>0.12</td>
      <td>0.44</td>
      <td>0.33</td>
    </tr>
    <tr>
      <th>id_2</th>
      <td>1.49</td>
      <td>-0.21</td>
      <td>0.31</td>
      <td>-0.85</td>
    </tr>
    <tr>
      <th>id_3</th>
      <td>-2.55</td>
      <td>0.65</td>
      <td>0.86</td>
      <td>-0.74</td>
    </tr>
  </tbody>
</table>
</div>



- 행 인덱스도 같은 방법으로 다중 인덱스로 생성 가능하다.

## 행 인덱스와 열 인덱스 교환


```python
# stack(열 인덱스 이름): 열 인덱스 -> 행 인덱스
df4.stack("Cidx1")
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>Cidx2</th>
      <th>C</th>
      <th>D</th>
    </tr>
    <tr>
      <th>Ridx1</th>
      <th>Ridx2</th>
      <th>Cidx1</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="6" valign="top">M</th>
      <th rowspan="2" valign="top">id_1</th>
      <th>A</th>
      <td>1.76</td>
      <td>0.40</td>
    </tr>
    <tr>
      <th>B</th>
      <td>0.98</td>
      <td>2.24</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">id_2</th>
      <th>A</th>
      <td>1.87</td>
      <td>-0.98</td>
    </tr>
    <tr>
      <th>B</th>
      <td>0.95</td>
      <td>-0.15</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">id_3</th>
      <th>A</th>
      <td>-0.10</td>
      <td>0.41</td>
    </tr>
    <tr>
      <th>B</th>
      <td>0.14</td>
      <td>1.45</td>
    </tr>
    <tr>
      <th rowspan="6" valign="top">F</th>
      <th rowspan="2" valign="top">id_1</th>
      <th>A</th>
      <td>0.76</td>
      <td>0.12</td>
    </tr>
    <tr>
      <th>B</th>
      <td>0.44</td>
      <td>0.33</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">id_2</th>
      <th>A</th>
      <td>1.49</td>
      <td>-0.21</td>
    </tr>
    <tr>
      <th>B</th>
      <td>0.31</td>
      <td>-0.85</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">id_3</th>
      <th>A</th>
      <td>-2.55</td>
      <td>0.65</td>
    </tr>
    <tr>
      <th>B</th>
      <td>0.86</td>
      <td>-0.74</td>
    </tr>
  </tbody>
</table>
</div>



- `stack()`을 사용해서 기존 열 인덱스의 이름을 지정하면 행 인덱스로 변경된다.


- staack이라는 이름처럼 데이터가 세로로 쌓이게 된다.


```python
df4.stack(1)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>Cidx1</th>
      <th>A</th>
      <th>B</th>
    </tr>
    <tr>
      <th>Ridx1</th>
      <th>Ridx2</th>
      <th>Cidx2</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="6" valign="top">M</th>
      <th rowspan="2" valign="top">id_1</th>
      <th>C</th>
      <td>1.76</td>
      <td>0.98</td>
    </tr>
    <tr>
      <th>D</th>
      <td>0.40</td>
      <td>2.24</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">id_2</th>
      <th>C</th>
      <td>1.87</td>
      <td>0.95</td>
    </tr>
    <tr>
      <th>D</th>
      <td>-0.98</td>
      <td>-0.15</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">id_3</th>
      <th>C</th>
      <td>-0.10</td>
      <td>0.14</td>
    </tr>
    <tr>
      <th>D</th>
      <td>0.41</td>
      <td>1.45</td>
    </tr>
    <tr>
      <th rowspan="6" valign="top">F</th>
      <th rowspan="2" valign="top">id_1</th>
      <th>C</th>
      <td>0.76</td>
      <td>0.44</td>
    </tr>
    <tr>
      <th>D</th>
      <td>0.12</td>
      <td>0.33</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">id_2</th>
      <th>C</th>
      <td>1.49</td>
      <td>0.31</td>
    </tr>
    <tr>
      <th>D</th>
      <td>-0.21</td>
      <td>-0.85</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">id_3</th>
      <th>C</th>
      <td>-2.55</td>
      <td>0.86</td>
    </tr>
    <tr>
      <th>D</th>
      <td>0.65</td>
      <td>-0.74</td>
    </tr>
  </tbody>
</table>
</div>



- 위 예시와 같이 열 인덱스 이름이 아닌 열 인덱스 이름의 순서를 지정해도 같은 결과가 출력된다.


```python
# unstack(행 인덱스 이름): 행 인덱스 -> 열 인덱스
df4.unstack("Ridx2")
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th>Cidx1</th>
      <th colspan="6" halign="left">A</th>
      <th colspan="6" halign="left">B</th>
    </tr>
    <tr>
      <th>Cidx2</th>
      <th colspan="3" halign="left">C</th>
      <th colspan="3" halign="left">D</th>
      <th colspan="3" halign="left">C</th>
      <th colspan="3" halign="left">D</th>
    </tr>
    <tr>
      <th>Ridx2</th>
      <th>id_1</th>
      <th>id_2</th>
      <th>id_3</th>
      <th>id_1</th>
      <th>id_2</th>
      <th>id_3</th>
      <th>id_1</th>
      <th>id_2</th>
      <th>id_3</th>
      <th>id_1</th>
      <th>id_2</th>
      <th>id_3</th>
    </tr>
    <tr>
      <th>Ridx1</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>F</th>
      <td>0.76</td>
      <td>1.49</td>
      <td>-2.55</td>
      <td>0.12</td>
      <td>-0.21</td>
      <td>0.65</td>
      <td>0.44</td>
      <td>0.31</td>
      <td>0.86</td>
      <td>0.33</td>
      <td>-0.85</td>
      <td>-0.74</td>
    </tr>
    <tr>
      <th>M</th>
      <td>1.76</td>
      <td>1.87</td>
      <td>-0.10</td>
      <td>0.40</td>
      <td>-0.98</td>
      <td>0.41</td>
      <td>0.98</td>
      <td>0.95</td>
      <td>0.14</td>
      <td>2.24</td>
      <td>-0.15</td>
      <td>1.45</td>
    </tr>
  </tbody>
</table>
</div>



- `unstack()`을 사용하여 기존 행 인덱스의 이름을 지정하면 열 인덱스로 변경된다.


```python
df4.unstack(0)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th>Cidx1</th>
      <th colspan="4" halign="left">A</th>
      <th colspan="4" halign="left">B</th>
    </tr>
    <tr>
      <th>Cidx2</th>
      <th colspan="2" halign="left">C</th>
      <th colspan="2" halign="left">D</th>
      <th colspan="2" halign="left">C</th>
      <th colspan="2" halign="left">D</th>
    </tr>
    <tr>
      <th>Ridx1</th>
      <th>F</th>
      <th>M</th>
      <th>F</th>
      <th>M</th>
      <th>F</th>
      <th>M</th>
      <th>F</th>
      <th>M</th>
    </tr>
    <tr>
      <th>Ridx2</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>id_1</th>
      <td>0.76</td>
      <td>1.76</td>
      <td>0.12</td>
      <td>0.40</td>
      <td>0.44</td>
      <td>0.98</td>
      <td>0.33</td>
      <td>2.24</td>
    </tr>
    <tr>
      <th>id_2</th>
      <td>1.49</td>
      <td>1.87</td>
      <td>-0.21</td>
      <td>-0.98</td>
      <td>0.31</td>
      <td>0.95</td>
      <td>-0.85</td>
      <td>-0.15</td>
    </tr>
    <tr>
      <th>id_3</th>
      <td>-2.55</td>
      <td>-0.10</td>
      <td>0.65</td>
      <td>0.41</td>
      <td>0.86</td>
      <td>0.14</td>
      <td>-0.74</td>
      <td>1.45</td>
    </tr>
  </tbody>
</table>
</div>



- `stack()`과 마찬가지로 정수를 지정해도 같은 결과가 출력된다.

## 다중 인덱스가 있는 경우의 인덱싱


```python
df4
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th>Cidx1</th>
      <th colspan="2" halign="left">A</th>
      <th colspan="2" halign="left">B</th>
    </tr>
    <tr>
      <th></th>
      <th>Cidx2</th>
      <th>C</th>
      <th>D</th>
      <th>C</th>
      <th>D</th>
    </tr>
    <tr>
      <th>Ridx1</th>
      <th>Ridx2</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="3" valign="top">M</th>
      <th>id_1</th>
      <td>1.76</td>
      <td>0.40</td>
      <td>0.98</td>
      <td>2.24</td>
    </tr>
    <tr>
      <th>id_2</th>
      <td>1.87</td>
      <td>-0.98</td>
      <td>0.95</td>
      <td>-0.15</td>
    </tr>
    <tr>
      <th>id_3</th>
      <td>-0.10</td>
      <td>0.41</td>
      <td>0.14</td>
      <td>1.45</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">F</th>
      <th>id_1</th>
      <td>0.76</td>
      <td>0.12</td>
      <td>0.44</td>
      <td>0.33</td>
    </tr>
    <tr>
      <th>id_2</th>
      <td>1.49</td>
      <td>-0.21</td>
      <td>0.31</td>
      <td>-0.85</td>
    </tr>
    <tr>
      <th>id_3</th>
      <td>-2.55</td>
      <td>0.65</td>
      <td>0.86</td>
      <td>-0.74</td>
    </tr>
  </tbody>
</table>
</div>




```python
df4[ ("A", "C") ]
```




    Ridx1  Ridx2
    M      id_1     1.76
           id_2     1.87
           id_3    -0.10
    F      id_1     0.76
           id_2     1.49
           id_3    -2.55
    Name: (A, C), dtype: float64



- 다중 인덱스가 존재한다면 인덱싱할 때 튜플 형식으로 지정해야한다.


```python
df4.loc[ ("M","id_1"), :]
```




    Cidx1  Cidx2
    A      C        1.76
           D        0.40
    B      C        0.98
           D        2.24
    Name: (M, id_1), dtype: float64



- loc 인덱서도 마찬가지로 튜플 형식으로 지정해야한다.


```python
df4.loc[ ("M","id_1"), ("A", "C")] = 100
df4
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th>Cidx1</th>
      <th colspan="2" halign="left">A</th>
      <th colspan="2" halign="left">B</th>
    </tr>
    <tr>
      <th></th>
      <th>Cidx2</th>
      <th>C</th>
      <th>D</th>
      <th>C</th>
      <th>D</th>
    </tr>
    <tr>
      <th>Ridx1</th>
      <th>Ridx2</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="3" valign="top">M</th>
      <th>id_1</th>
      <td>100.00</td>
      <td>0.40</td>
      <td>0.98</td>
      <td>2.24</td>
    </tr>
    <tr>
      <th>id_2</th>
      <td>1.87</td>
      <td>-0.98</td>
      <td>0.95</td>
      <td>-0.15</td>
    </tr>
    <tr>
      <th>id_3</th>
      <td>-0.10</td>
      <td>0.41</td>
      <td>0.14</td>
      <td>1.45</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">F</th>
      <th>id_1</th>
      <td>0.76</td>
      <td>0.12</td>
      <td>0.44</td>
      <td>0.33</td>
    </tr>
    <tr>
      <th>id_2</th>
      <td>1.49</td>
      <td>-0.21</td>
      <td>0.31</td>
      <td>-0.85</td>
    </tr>
    <tr>
      <th>id_3</th>
      <td>-2.55</td>
      <td>0.65</td>
      <td>0.86</td>
      <td>-0.74</td>
    </tr>
  </tbody>
</table>
</div>



- 다중 인덱스에서 데이터 갱신도 튜플 형식으로 지정하면 문제없이 잘 수행된다.


```python
df4.iloc[0:, 0:2]
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th>Cidx1</th>
      <th colspan="2" halign="left">A</th>
    </tr>
    <tr>
      <th></th>
      <th>Cidx2</th>
      <th>C</th>
      <th>D</th>
    </tr>
    <tr>
      <th>Ridx1</th>
      <th>Ridx2</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="3" valign="top">M</th>
      <th>id_1</th>
      <td>100.00</td>
      <td>0.40</td>
    </tr>
    <tr>
      <th>id_2</th>
      <td>1.87</td>
      <td>-0.98</td>
    </tr>
    <tr>
      <th>id_3</th>
      <td>-0.10</td>
      <td>0.41</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">F</th>
      <th>id_1</th>
      <td>0.76</td>
      <td>0.12</td>
    </tr>
    <tr>
      <th>id_2</th>
      <td>1.49</td>
      <td>-0.21</td>
    </tr>
    <tr>
      <th>id_3</th>
      <td>-2.55</td>
      <td>0.65</td>
    </tr>
  </tbody>
</table>
</div>



- iloc 인덱서는 튜플 형태의 다중 인덱스 사용이 불가능하다.


```python
df4["A"]
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Cidx2</th>
      <th>C</th>
      <th>D</th>
    </tr>
    <tr>
      <th>Ridx1</th>
      <th>Ridx2</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="3" valign="top">M</th>
      <th>id_1</th>
      <td>100.00</td>
      <td>0.40</td>
    </tr>
    <tr>
      <th>id_2</th>
      <td>1.87</td>
      <td>-0.98</td>
    </tr>
    <tr>
      <th>id_3</th>
      <td>-0.10</td>
      <td>0.41</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">F</th>
      <th>id_1</th>
      <td>0.76</td>
      <td>0.12</td>
    </tr>
    <tr>
      <th>id_2</th>
      <td>1.49</td>
      <td>-0.21</td>
    </tr>
    <tr>
      <th>id_3</th>
      <td>-2.55</td>
      <td>0.65</td>
    </tr>
  </tbody>
</table>
</div>



- 다중 인덱스가 존재하는데 그냥 인덱싱하면 가장 상위의 인덱스 레벨로 판단하고 출력한다.


- 따라서 두 번째 레벨의 인덱스 값을 넣으면 애러가 발생한다.


```python
df4.loc["M"]
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th>Cidx1</th>
      <th colspan="2" halign="left">A</th>
      <th colspan="2" halign="left">B</th>
    </tr>
    <tr>
      <th>Cidx2</th>
      <th>C</th>
      <th>D</th>
      <th>C</th>
      <th>D</th>
    </tr>
    <tr>
      <th>Ridx2</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>id_1</th>
      <td>100.00</td>
      <td>0.40</td>
      <td>0.98</td>
      <td>2.24</td>
    </tr>
    <tr>
      <th>id_2</th>
      <td>1.87</td>
      <td>-0.98</td>
      <td>0.95</td>
      <td>-0.15</td>
    </tr>
    <tr>
      <th>id_3</th>
      <td>-0.10</td>
      <td>0.41</td>
      <td>0.14</td>
      <td>1.45</td>
    </tr>
  </tbody>
</table>
</div>



- loc 인덱서에서도 그냥 인덱싱하면 가장 상위의 인덱스 레벨로 판단하고 출력한다.


- loc인덱서는 하나의 인덱싱은 행이 기준임을 한번 더 확인하자.


```python
# 다중 인덱스에서 데이터 추가 - 행 추가
df4.loc[("All", "All"), :] = df4.sum()
df4
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th>Cidx1</th>
      <th colspan="2" halign="left">A</th>
      <th colspan="2" halign="left">B</th>
    </tr>
    <tr>
      <th></th>
      <th>Cidx2</th>
      <th>C</th>
      <th>D</th>
      <th>C</th>
      <th>D</th>
    </tr>
    <tr>
      <th>Ridx1</th>
      <th>Ridx2</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="3" valign="top">M</th>
      <th>id_1</th>
      <td>100.00</td>
      <td>0.40</td>
      <td>0.98</td>
      <td>2.24</td>
    </tr>
    <tr>
      <th>id_2</th>
      <td>1.87</td>
      <td>-0.98</td>
      <td>0.95</td>
      <td>-0.15</td>
    </tr>
    <tr>
      <th>id_3</th>
      <td>-0.10</td>
      <td>0.41</td>
      <td>0.14</td>
      <td>1.45</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">F</th>
      <th>id_1</th>
      <td>0.76</td>
      <td>0.12</td>
      <td>0.44</td>
      <td>0.33</td>
    </tr>
    <tr>
      <th>id_2</th>
      <td>1.49</td>
      <td>-0.21</td>
      <td>0.31</td>
      <td>-0.85</td>
    </tr>
    <tr>
      <th>id_3</th>
      <td>-2.55</td>
      <td>0.65</td>
      <td>0.86</td>
      <td>-0.74</td>
    </tr>
    <tr>
      <th>All</th>
      <th>All</th>
      <td>101.47</td>
      <td>0.39</td>
      <td>3.68</td>
      <td>2.28</td>
    </tr>
  </tbody>
</table>
</div>



- 다중 인덱스에서 데이터 추가 역시 튜플 형식으로 지정해준다.


```python
df4.loc[("M", slice(None)), ("A",slice(None))]
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th>Cidx1</th>
      <th colspan="2" halign="left">A</th>
    </tr>
    <tr>
      <th></th>
      <th>Cidx2</th>
      <th>C</th>
      <th>D</th>
    </tr>
    <tr>
      <th>Ridx1</th>
      <th>Ridx2</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="3" valign="top">M</th>
      <th>id_1</th>
      <td>100.00</td>
      <td>0.40</td>
    </tr>
    <tr>
      <th>id_2</th>
      <td>1.87</td>
      <td>-0.98</td>
    </tr>
    <tr>
      <th>id_3</th>
      <td>-0.10</td>
      <td>0.41</td>
    </tr>
  </tbody>
</table>
</div>



- 만약 상위 레벨의 인덱스는 선택하고 해당 인덱스의 하위 레벨을 모두 출력하고 싶다면 `slice(None)`을 사용한다.


- 위 예시는 행 인덱스는 M의 하위 레벨을 모두 포함하고, 열 인덱스는 A의 하위 레벨을 모두 포함해서 출력한다.


- 일반적으로 콜론(:)을 사용한 반면 다중 인덱스에선 `slice(None)`을 사용하여야 한다는 것을 기억하자.

## 다중 인덱스의 인덱스 순서 교환


```python
# 행 인덱스 레벨 교환
df5 = df4.swaplevel("Ridx1", "Ridx2")
df5
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th>Cidx1</th>
      <th colspan="2" halign="left">A</th>
      <th colspan="2" halign="left">B</th>
    </tr>
    <tr>
      <th></th>
      <th>Cidx2</th>
      <th>C</th>
      <th>D</th>
      <th>C</th>
      <th>D</th>
    </tr>
    <tr>
      <th>Ridx2</th>
      <th>Ridx1</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>id_1</th>
      <th>M</th>
      <td>100.00</td>
      <td>0.40</td>
      <td>0.98</td>
      <td>2.24</td>
    </tr>
    <tr>
      <th>id_2</th>
      <th>M</th>
      <td>1.87</td>
      <td>-0.98</td>
      <td>0.95</td>
      <td>-0.15</td>
    </tr>
    <tr>
      <th>id_3</th>
      <th>M</th>
      <td>-0.10</td>
      <td>0.41</td>
      <td>0.14</td>
      <td>1.45</td>
    </tr>
    <tr>
      <th>id_1</th>
      <th>F</th>
      <td>0.76</td>
      <td>0.12</td>
      <td>0.44</td>
      <td>0.33</td>
    </tr>
    <tr>
      <th>id_2</th>
      <th>F</th>
      <td>1.49</td>
      <td>-0.21</td>
      <td>0.31</td>
      <td>-0.85</td>
    </tr>
    <tr>
      <th>id_3</th>
      <th>F</th>
      <td>-2.55</td>
      <td>0.65</td>
      <td>0.86</td>
      <td>-0.74</td>
    </tr>
    <tr>
      <th>All</th>
      <th>All</th>
      <td>101.47</td>
      <td>0.39</td>
      <td>3.68</td>
      <td>2.28</td>
    </tr>
  </tbody>
</table>
</div>



- `swaplevel(i, j)`는 인덱스 i와 j를 교환하여 레벨이 변경된다.
 
 
- 여기서 axis는 0이 디폴트이고 일반적으로 0이 열인데 반해 이 함수에선 행을 의미한다.


```python
# 열 인덱스 레벨 교환
df6 = df4.swaplevel(0,1, axis=1)
df6
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th>Cidx2</th>
      <th>C</th>
      <th>D</th>
      <th>C</th>
      <th>D</th>
    </tr>
    <tr>
      <th></th>
      <th>Cidx1</th>
      <th>A</th>
      <th>A</th>
      <th>B</th>
      <th>B</th>
    </tr>
    <tr>
      <th>Ridx1</th>
      <th>Ridx2</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="3" valign="top">M</th>
      <th>id_1</th>
      <td>100.00</td>
      <td>0.40</td>
      <td>0.98</td>
      <td>2.24</td>
    </tr>
    <tr>
      <th>id_2</th>
      <td>1.87</td>
      <td>-0.98</td>
      <td>0.95</td>
      <td>-0.15</td>
    </tr>
    <tr>
      <th>id_3</th>
      <td>-0.10</td>
      <td>0.41</td>
      <td>0.14</td>
      <td>1.45</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">F</th>
      <th>id_1</th>
      <td>0.76</td>
      <td>0.12</td>
      <td>0.44</td>
      <td>0.33</td>
    </tr>
    <tr>
      <th>id_2</th>
      <td>1.49</td>
      <td>-0.21</td>
      <td>0.31</td>
      <td>-0.85</td>
    </tr>
    <tr>
      <th>id_3</th>
      <td>-2.55</td>
      <td>0.65</td>
      <td>0.86</td>
      <td>-0.74</td>
    </tr>
    <tr>
      <th>All</th>
      <th>All</th>
      <td>101.47</td>
      <td>0.39</td>
      <td>3.68</td>
      <td>2.28</td>
    </tr>
  </tbody>
</table>
</div>



## 다중 인덱스가 있는 경우의 정렬


```python
df5.sort_index(level=0)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th>Cidx1</th>
      <th colspan="2" halign="left">A</th>
      <th colspan="2" halign="left">B</th>
    </tr>
    <tr>
      <th></th>
      <th>Cidx2</th>
      <th>C</th>
      <th>D</th>
      <th>C</th>
      <th>D</th>
    </tr>
    <tr>
      <th>Ridx2</th>
      <th>Ridx1</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>All</th>
      <th>All</th>
      <td>101.47</td>
      <td>0.39</td>
      <td>3.68</td>
      <td>2.28</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">id_1</th>
      <th>F</th>
      <td>0.76</td>
      <td>0.12</td>
      <td>0.44</td>
      <td>0.33</td>
    </tr>
    <tr>
      <th>M</th>
      <td>100.00</td>
      <td>0.40</td>
      <td>0.98</td>
      <td>2.24</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">id_2</th>
      <th>F</th>
      <td>1.49</td>
      <td>-0.21</td>
      <td>0.31</td>
      <td>-0.85</td>
    </tr>
    <tr>
      <th>M</th>
      <td>1.87</td>
      <td>-0.98</td>
      <td>0.95</td>
      <td>-0.15</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">id_3</th>
      <th>F</th>
      <td>-2.55</td>
      <td>0.65</td>
      <td>0.86</td>
      <td>-0.74</td>
    </tr>
    <tr>
      <th>M</th>
      <td>-0.10</td>
      <td>0.41</td>
      <td>0.14</td>
      <td>1.45</td>
    </tr>
  </tbody>
</table>
</div>



- 다중 인덱스가 존재한다면 정렬시에 level 옵션을 사용한다.
 
 
- 여기서도 axis는 0이 디폴트이고 행을 의미한다.


```python
# 열 인덱스 기준 정렬
df6.sort_index(axis=1, level=0)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th>Cidx2</th>
      <th colspan="2" halign="left">C</th>
      <th colspan="2" halign="left">D</th>
    </tr>
    <tr>
      <th></th>
      <th>Cidx1</th>
      <th>A</th>
      <th>B</th>
      <th>A</th>
      <th>B</th>
    </tr>
    <tr>
      <th>Ridx1</th>
      <th>Ridx2</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="3" valign="top">M</th>
      <th>id_1</th>
      <td>100.00</td>
      <td>0.98</td>
      <td>0.40</td>
      <td>2.24</td>
    </tr>
    <tr>
      <th>id_2</th>
      <td>1.87</td>
      <td>0.95</td>
      <td>-0.98</td>
      <td>-0.15</td>
    </tr>
    <tr>
      <th>id_3</th>
      <td>-0.10</td>
      <td>0.14</td>
      <td>0.41</td>
      <td>1.45</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">F</th>
      <th>id_1</th>
      <td>0.76</td>
      <td>0.44</td>
      <td>0.12</td>
      <td>0.33</td>
    </tr>
    <tr>
      <th>id_2</th>
      <td>1.49</td>
      <td>0.31</td>
      <td>-0.21</td>
      <td>-0.85</td>
    </tr>
    <tr>
      <th>id_3</th>
      <td>-2.55</td>
      <td>0.86</td>
      <td>0.65</td>
      <td>-0.74</td>
    </tr>
    <tr>
      <th>All</th>
      <th>All</th>
      <td>101.47</td>
      <td>3.68</td>
      <td>0.39</td>
      <td>2.28</td>
    </tr>
  </tbody>
</table>
</div>



## 연습 문제 4.5.2

A 반 학생 5명과 B반 학생 5명의 국어, 영어, 수학 점수를 나타내는 데이터프레임을 다음과 같이 만든다.

1. "반", "번호", "국어", "영어", "수학" 을 열로 가지는 데이터프레임 `df_score3`을 만든다.


2. `df_score3`을 변형하여 1차 행 인덱스로 "반"을 2차 행 인덱스로 "번호"을 가지는 데이터프레임 `df_score4`을 만든다.


3. 데이터 프레임 `df_score4`에 각 학생의 평균을 나타내는 행을 오른쪽에 추가한다.


4. `df_score3`을 변형하여 행 인덱스로 "번호"를, 1차 열 인덱스로 "국어", "영어", "수학"을, 2차 열 인덱스로 "반"을 가지는 데이터프레임 `df_score5`을 만든다.


5. 데이터 프레임 `df_score5`에 각 반별 각 과목의 평균을 나타내는 행을 아래에 추가한다.


```python
# 기초 배열 생성
np.random.seed(93)

data = []
for i in range(10):
    if i <=4:
        data.append( ["A",i+1] + list(np.random.randint(0,101,size=3)) )
    else:
        data.append( ["B",i+1] + list(np.random.randint(0,101,size=3)) )

data
```




    [['A', 1, 37, 91, 4],
     ['A', 2, 24, 79, 97],
     ['A', 3, 85, 48, 77],
     ['A', 4, 52, 52, 51],
     ['A', 5, 21, 49, 74],
     ['B', 6, 33, 8, 71],
     ['B', 7, 80, 88, 9],
     ['B', 8, 55, 11, 5],
     ['B', 9, 44, 43, 46],
     ['B', 10, 15, 32, 91]]




```python
# 1. df_score3 생성
df_score3 = pd.DataFrame(
    data, columns = ["반", "번호", "국어", "영어", "수학"]
)

df_score3
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>반</th>
      <th>번호</th>
      <th>국어</th>
      <th>영어</th>
      <th>수학</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>A</td>
      <td>1</td>
      <td>37</td>
      <td>91</td>
      <td>4</td>
    </tr>
    <tr>
      <th>1</th>
      <td>A</td>
      <td>2</td>
      <td>24</td>
      <td>79</td>
      <td>97</td>
    </tr>
    <tr>
      <th>2</th>
      <td>A</td>
      <td>3</td>
      <td>85</td>
      <td>48</td>
      <td>77</td>
    </tr>
    <tr>
      <th>3</th>
      <td>A</td>
      <td>4</td>
      <td>52</td>
      <td>52</td>
      <td>51</td>
    </tr>
    <tr>
      <th>4</th>
      <td>A</td>
      <td>5</td>
      <td>21</td>
      <td>49</td>
      <td>74</td>
    </tr>
    <tr>
      <th>5</th>
      <td>B</td>
      <td>6</td>
      <td>33</td>
      <td>8</td>
      <td>71</td>
    </tr>
    <tr>
      <th>6</th>
      <td>B</td>
      <td>7</td>
      <td>80</td>
      <td>88</td>
      <td>9</td>
    </tr>
    <tr>
      <th>7</th>
      <td>B</td>
      <td>8</td>
      <td>55</td>
      <td>11</td>
      <td>5</td>
    </tr>
    <tr>
      <th>8</th>
      <td>B</td>
      <td>9</td>
      <td>44</td>
      <td>43</td>
      <td>46</td>
    </tr>
    <tr>
      <th>9</th>
      <td>B</td>
      <td>10</td>
      <td>15</td>
      <td>32</td>
      <td>91</td>
    </tr>
  </tbody>
</table>
</div>




```python
# 2. df_score3을 변형하여 1차 행 인덱스로 "반", 2차 행 인덱스로 "번호"을 가지는 데이터프레임 df_score4
df_score4 = df_score3.set_index(["반","번호"])
df_score4
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>국어</th>
      <th>영어</th>
      <th>수학</th>
    </tr>
    <tr>
      <th>반</th>
      <th>번호</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">A</th>
      <th>1</th>
      <td>37</td>
      <td>91</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2</th>
      <td>24</td>
      <td>79</td>
      <td>97</td>
    </tr>
    <tr>
      <th>3</th>
      <td>85</td>
      <td>48</td>
      <td>77</td>
    </tr>
    <tr>
      <th>4</th>
      <td>52</td>
      <td>52</td>
      <td>51</td>
    </tr>
    <tr>
      <th>5</th>
      <td>21</td>
      <td>49</td>
      <td>74</td>
    </tr>
    <tr>
      <th rowspan="5" valign="top">B</th>
      <th>6</th>
      <td>33</td>
      <td>8</td>
      <td>71</td>
    </tr>
    <tr>
      <th>7</th>
      <td>80</td>
      <td>88</td>
      <td>9</td>
    </tr>
    <tr>
      <th>8</th>
      <td>55</td>
      <td>11</td>
      <td>5</td>
    </tr>
    <tr>
      <th>9</th>
      <td>44</td>
      <td>43</td>
      <td>46</td>
    </tr>
    <tr>
      <th>10</th>
      <td>15</td>
      <td>32</td>
      <td>91</td>
    </tr>
  </tbody>
</table>
</div>




```python
# 3. df_score4에 각 학생의 평균을 나타내는 행을 오른쪽에 추가한다.
df_score4["mean_score"] = round(df_score4.mean(axis=1),2)
df_score4
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>국어</th>
      <th>영어</th>
      <th>수학</th>
      <th>mean_score</th>
    </tr>
    <tr>
      <th>반</th>
      <th>번호</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">A</th>
      <th>1</th>
      <td>37</td>
      <td>91</td>
      <td>4</td>
      <td>44.00</td>
    </tr>
    <tr>
      <th>2</th>
      <td>24</td>
      <td>79</td>
      <td>97</td>
      <td>66.67</td>
    </tr>
    <tr>
      <th>3</th>
      <td>85</td>
      <td>48</td>
      <td>77</td>
      <td>70.00</td>
    </tr>
    <tr>
      <th>4</th>
      <td>52</td>
      <td>52</td>
      <td>51</td>
      <td>51.67</td>
    </tr>
    <tr>
      <th>5</th>
      <td>21</td>
      <td>49</td>
      <td>74</td>
      <td>48.00</td>
    </tr>
    <tr>
      <th rowspan="5" valign="top">B</th>
      <th>6</th>
      <td>33</td>
      <td>8</td>
      <td>71</td>
      <td>37.33</td>
    </tr>
    <tr>
      <th>7</th>
      <td>80</td>
      <td>88</td>
      <td>9</td>
      <td>59.00</td>
    </tr>
    <tr>
      <th>8</th>
      <td>55</td>
      <td>11</td>
      <td>5</td>
      <td>23.67</td>
    </tr>
    <tr>
      <th>9</th>
      <td>44</td>
      <td>43</td>
      <td>46</td>
      <td>44.33</td>
    </tr>
    <tr>
      <th>10</th>
      <td>15</td>
      <td>32</td>
      <td>91</td>
      <td>46.00</td>
    </tr>
  </tbody>
</table>
</div>




```python
# 4. df_score3을 변형하여 행 인덱스로 "번호"를, 1차 열 인덱스로 "국어", "영어", "수학"을, 
# 2차 열 인덱스로 "반"을 가지는 데이터프레임 df_score5을 만든다.

temp = df_score3.set_index(["번호","반"])
df_score5 =temp.unstack("반").sort_index(level=0)
df_score5
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="2" halign="left">국어</th>
      <th colspan="2" halign="left">영어</th>
      <th colspan="2" halign="left">수학</th>
    </tr>
    <tr>
      <th>반</th>
      <th>A</th>
      <th>B</th>
      <th>A</th>
      <th>B</th>
      <th>A</th>
      <th>B</th>
    </tr>
    <tr>
      <th>번호</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>37.0</td>
      <td>NaN</td>
      <td>91.0</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>24.0</td>
      <td>NaN</td>
      <td>79.0</td>
      <td>NaN</td>
      <td>97.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>85.0</td>
      <td>NaN</td>
      <td>48.0</td>
      <td>NaN</td>
      <td>77.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>52.0</td>
      <td>NaN</td>
      <td>52.0</td>
      <td>NaN</td>
      <td>51.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>5</th>
      <td>21.0</td>
      <td>NaN</td>
      <td>49.0</td>
      <td>NaN</td>
      <td>74.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>6</th>
      <td>NaN</td>
      <td>33.0</td>
      <td>NaN</td>
      <td>8.0</td>
      <td>NaN</td>
      <td>71.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>NaN</td>
      <td>80.0</td>
      <td>NaN</td>
      <td>88.0</td>
      <td>NaN</td>
      <td>9.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>NaN</td>
      <td>55.0</td>
      <td>NaN</td>
      <td>11.0</td>
      <td>NaN</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>NaN</td>
      <td>44.0</td>
      <td>NaN</td>
      <td>43.0</td>
      <td>NaN</td>
      <td>46.0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>NaN</td>
      <td>15.0</td>
      <td>NaN</td>
      <td>32.0</td>
      <td>NaN</td>
      <td>91.0</td>
    </tr>
  </tbody>
</table>
</div>



- 번호가 1이고 B반인 학생은 없으므로 값이 NaN으로 뜬다.


- 다른 NaN 값도 같은 경우이다.


- 이 값을 0으로 대체하기엔 없는 학생의 점수를 0점으로 부여하는 것이라 그냥 두었다.


```python
# 5. 데이터 프레임 df_score5에 각 반별 각 과목의 평균을 나타내는 행을 아래에 추가한다.
df_score5.loc["평균",:] = df_score5.mean()
df_score5
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="2" halign="left">국어</th>
      <th colspan="2" halign="left">영어</th>
      <th colspan="2" halign="left">수학</th>
    </tr>
    <tr>
      <th>반</th>
      <th>A</th>
      <th>B</th>
      <th>A</th>
      <th>B</th>
      <th>A</th>
      <th>B</th>
    </tr>
    <tr>
      <th>번호</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>37.0</td>
      <td>NaN</td>
      <td>91.0</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>24.0</td>
      <td>NaN</td>
      <td>79.0</td>
      <td>NaN</td>
      <td>97.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>85.0</td>
      <td>NaN</td>
      <td>48.0</td>
      <td>NaN</td>
      <td>77.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>52.0</td>
      <td>NaN</td>
      <td>52.0</td>
      <td>NaN</td>
      <td>51.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>5</th>
      <td>21.0</td>
      <td>NaN</td>
      <td>49.0</td>
      <td>NaN</td>
      <td>74.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>6</th>
      <td>NaN</td>
      <td>33.0</td>
      <td>NaN</td>
      <td>8.0</td>
      <td>NaN</td>
      <td>71.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>NaN</td>
      <td>80.0</td>
      <td>NaN</td>
      <td>88.0</td>
      <td>NaN</td>
      <td>9.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>NaN</td>
      <td>55.0</td>
      <td>NaN</td>
      <td>11.0</td>
      <td>NaN</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>NaN</td>
      <td>44.0</td>
      <td>NaN</td>
      <td>43.0</td>
      <td>NaN</td>
      <td>46.0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>NaN</td>
      <td>15.0</td>
      <td>NaN</td>
      <td>32.0</td>
      <td>NaN</td>
      <td>91.0</td>
    </tr>
    <tr>
      <th>평균</th>
      <td>43.8</td>
      <td>45.4</td>
      <td>63.8</td>
      <td>36.4</td>
      <td>60.6</td>
      <td>44.4</td>
    </tr>
  </tbody>
</table>
</div>


